<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uploaded Image</title>
    <link rel="icon" href="{{ url_for('static', filename='HV.png') }}" type="img/x-icon"/>
    <link rel="stylesheet" href="../static/styles.css"></link>
    <link href="https://fonts.googleapis.com/css2?family=Gupter:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=DynaPuff&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <h1>Uploaded Image</h1>
    <button class="filter-btn" onclick="toggleFilterPanel()">
        <img src="../static/images/filter-icon.png" alt="Filter Icon" class="filter-icon"></button>
    <button class="download-btn" onclick="downloadImage()">
        <img src="../static/images/download.png" alt="Download Icon" class="download-icon"></button>
<div class="filter-panel" id="filterPanel">
    <button class="close-btn" onclick="toggleFilterPanel()">Ã—</button>
    <h2>Image Filters</h2>
    <div class="filter-container">
        <label for="brightness">Brightness:</label>
        <input type="range" id="brightness" name="brightness" min="0" max="200" value="100">
        <label for="contrast">Contrast:</label>
        <input type="range" id="contrast" name="contrast" min="0" max="200" value="100">
        <label for="saturate">Saturation:</label>
        <input type="range" id="saturate" name="saturate" min="0" max="200" value="100">
        <label for="grayscale">Grayscale:</label>
        <input type="range" id="grayscale" name="grayscale" min="0" max="100" value="0">
        <label for="sepia">Sepia:</label>
        <input type="range" id="sepia" name="sepia" min="0" max="100" value="0">
        <label for="sharpness">Sharpness:</label>
        <input type="range" id="sharpness" min="0" max="200" value="100" onchange="applyFilters()">
        <label for="exposure">Exposure:</label>
        <input type="range" id="exposure" min="50" max="200" value="100" onchange="applyFilters()">
        <label for="highlights">Highlights:</label>
        <input type="range" id="highlights" min="0" max="200" value="100" onchange="applyFilters()">
        <label for="shadows">Shadows:</label>
        <input type="range" id="shadows" min="0" max="200" value="100" onchange="applyFilters()">
        <label for="temperature">Color Temperature:</label>
        <input type="range" id="temperature" min="0" max="200" value="100" onchange="applyFilters()">  
    </div>
</div>
    <img id="uploaded_image" src="{{ url_for('display_image', filename=filename) }}" alt="Uploaded Image" ondblclick="getColor(event)">
    <div class="content-container">
        <p>Color Name: <span id="color_name">Unknown</span></p>
        <p>Translated Color Name: <span id="translated_color_name">Unknown</span></p>
        <p>RGB Value: <span id="rgb_value">Unknown</span></p>
        <div class="language-container">
            <label for="language">Select Language:</label>
            <select id="language" name="language">
                <option value="en">English</option>
                <option value="ar">Arabic</option>
                <option value="fr">French</option>
                <option value="de">German</option>
                <option value="it">Italian</option>
                <option value="ja">Japanese</option>
                <option value="pt">Portuguese</option>
                <option value="ru">Russian</option>
                <option value="es">Spanish</option>
                <option value="pl">Polish</option>
                <option value="mr">Marathi</option>
                <option value="ko">Korean</option>
                <option value="hi">Hindi</option>
            </select>
        </div>
        <button onclick="speakText()">Speak Text</button>
    </div>
    <script>
function toggleFilterPanel() {
    var panel = document.getElementById('filterPanel');
    if (panel.style.display === "none" || panel.style.display === "") {
        panel.style.display = "block";  // Show the panel
        setTimeout(function() {
            panel.classList.add('active'); // Slide in after showing
        }, 10);  // Short delay to ensure the transition
    } else {
        panel.classList.remove('active'); // Slide out
        setTimeout(function() {
            panel.style.display = "none";  // Hide after sliding out
        }, 300);}}
function applyFilters() {
    var brightness = document.getElementById('brightness').value;
    var contrast = document.getElementById('contrast').value;
    var saturate = document.getElementById('saturate').value;
    var grayscale = document.getElementById('grayscale').value;
    var sepia = document.getElementById('sepia').value;
    var sharpness = document.getElementById('sharpness').value;
    var exposure = document.getElementById('exposure').value;
    var highlights = document.getElementById('highlights').value;
    var shadows = document.getElementById('shadows').value;
    var temperature = document.getElementById('temperature').value;
    var image = document.getElementById('uploaded_image');
    image.style.filter = `
        brightness(${brightness}%)
        contrast(${contrast}%)
        saturate(${saturate}%)
        grayscale(${grayscale}%)
        sepia(${sepia}%)
        contrast(${sharpness}%)
        brightness(${exposure}%)
        saturate(${highlights}%)
        grayscale(${100 - shadows}%)
        hue-rotate(${(temperature - 100) * 1.8}deg)`;}
document.getElementById('brightness').addEventListener('input', applyFilters);
document.getElementById('contrast').addEventListener('input', applyFilters);
document.getElementById('saturate').addEventListener('input', applyFilters);
document.getElementById('grayscale').addEventListener('input', applyFilters);
document.getElementById('sepia').addEventListener('input', applyFilters);
document.getElementById('sharpness').addEventListener('input', applyFilters);
document.getElementById('exposure').addEventListener('input', applyFilters);
document.getElementById('highlights').addEventListener('input', applyFilters);
document.getElementById('shadows').addEventListener('input', applyFilters);
document.getElementById('temperature').addEventListener('input', applyFilters);
function downloadImage() {
    var image = document.getElementById('uploaded_image');
    var canvas = document.createElement('canvas');
    canvas.width = image.naturalWidth;
    canvas.height = image.naturalHeight;
    var ctx = canvas.getContext('2d');

    // Apply the current filters to the canvas context
    var brightness = document.getElementById('brightness').value;
    var contrast = document.getElementById('contrast').value;
    var saturate = document.getElementById('saturate').value;
    var grayscale = document.getElementById('grayscale').value;
    var sepia = document.getElementById('sepia').value;
    var sharpness = document.getElementById('sharpness').value;
    var exposure = document.getElementById('exposure').value;
    var highlights = document.getElementById('highlights').value;
    var shadows = document.getElementById('shadows').value;
    var temperature = document.getElementById('temperature').value;

    ctx.filter = `
        brightness(${brightness}%)
        contrast(${contrast}%)
        saturate(${saturate}%)
        grayscale(${grayscale}%)
        sepia(${sepia}%)
        contrast(${sharpness}%)
        brightness(${exposure}%)
        saturate(${highlights}%)
        grayscale(${100 - shadows}%)
        hue-rotate(${(temperature - 100) * 1.8}deg)`;

    // Draw the image with filters applied to the canvas
    ctx.drawImage(image, 0, 0, canvas.width, canvas.height);

    // Create a link element and trigger the download of the canvas image
    var link = document.createElement('a');
    link.href = canvas.toDataURL('image/jpeg');
    link.download = 'edited_image.jpg'; // Set the default filename
    link.click();
}
function getColor(event) {
            var image = document.getElementById('uploaded_image');
            var canvas = document.createElement('canvas');
            canvas.width = image.width;
            canvas.height = image.height;
            var ctx = canvas.getContext('2d');
            ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
            var x = event.offsetX || event.clientX - image.offsetLeft;
            var y = event.offsetY || event.clientY - image.offsetTop;
            var pixel = ctx.getImageData(x, y, 1, 1).data;
            var r = pixel[0];
            var g = pixel[1];
            var b = pixel[2];
            var rgbString = `rgb(${r}, ${g}, ${b})`; // Convert RGB to string format
            // Display the RGB value in the designated area
            document.getElementById('rgb_value').textContent = rgbString;
            var language = document.getElementById('language').value;
            var formData = new FormData();
            formData.append('x', x);
            formData.append('y', y);
            formData.append('filename', '{{ filename }}');
            formData.append('language', language);          
            $.ajax({
                url: '/get_color_at_pixel',
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    document.getElementById('color_name').textContent = response.color_name;
                    document.getElementById('translated_color_name').textContent = response.translated_color_name;
                },
                error: function() {
                    alert('Error fetching color.');}});}
        function speakText() {
            var colorName = document.getElementById("color_name").textContent;
            var translatedColorName = document.getElementById("translated_color_name").textContent;
            var language = document.getElementById("language").value;
            var englishText = "The selected color is " + colorName;
            var englishSpeech = new SpeechSynthesisUtterance(englishText);
            englishSpeech.lang = 'en';
            window.speechSynthesis.speak(englishSpeech);
            var voices = window.speechSynthesis.getVoices();
            var selectedVoice = voices.find(voice => voice.lang.startsWith(language));
            if (selectedVoice) {
                var translatedText = "The translated name is " + translatedColorName;
                var translatedSpeech = new SpeechSynthesisUtterance(translatedText);
                translatedSpeech.voice = selectedVoice;
                translatedSpeech.lang = selectedVoice.lang;
                window.speechSynthesis.speak(translatedSpeech);
            } else {
                alert("Sorry, a voice for the selected language is not available.");
            }}
        window.speechSynthesis.onvoiceschanged = function() {
            var voices = window.speechSynthesis.getVoices();};
    </script>
</body>
</html>
